import{_ as t,c as n,d as e,a as l,e as s,b as p,w as d,r,o as h}from"./app-BLJpD-6k.js";const c={};function o(k,i){const a=r("VPLink");return h(),n("div",null,[i[3]||(i[3]=e(`<p>我们通过自定义依赖组件，实现了 RBAC 的轻松集成，它可以通过 FastAPI Depends 轻松集成</p><div class="hint-container caution"><p class="hint-container-title">警告</p><p>自 v1.2.0 开始，默认 RBAC 已更换为【<a href="#%E8%A7%92%E8%89%B2%E8%8F%9C%E5%8D%95">角色菜单</a>】，【<a href="#casbin">Casbin-RBAC</a>】将作为外置插件进行分发</p></div><h2 id="角色菜单" tabindex="-1"><a class="header-anchor" href="#角色菜单"><span>角色菜单</span></a></h2><p>要想实现此 RBAC 鉴权，需要进行以下配置</p><div class="vp-steps"><ol><li><p>添加接口依赖</p><p>只有在接口中添加以下依赖时，才能自动调用此鉴权方式</p><div class="language-py line-numbers-mode" data-highlighter="shiki" data-ext="py" style="--shiki-dark:#abb2bf;--shiki-light:#383A42;--shiki-dark-bg:#282c34;--shiki-light-bg:#FAFAFA;"><pre class="shiki shiki-themes one-dark-pro one-light vp-code"><code class="language-py"><span class="line"><span style="--shiki-dark:#61AFEF;--shiki-light:#4078F2;">@router</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#4078F2;">.</span><span style="--shiki-dark:#61AFEF;--shiki-light:#4078F2;">post</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span></span>
<span class="line"><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">    &#39;&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">,</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-dark-font-style:italic;--shiki-light:#986801;--shiki-light-font-style:inherit;">    summary</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;xxx&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">,</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-dark-font-style:italic;--shiki-light:#986801;--shiki-light-font-style:inherit;">    dependencies</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">[</span></span>
<span class="line highlighted"><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;">        Depends</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;">RequestPermission</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;sys:api:add&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)),</span><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">  # 通常为 xxx:xxx:xxx</span></span>
<span class="line highlighted"><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;">        DependsRBAC</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">,</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">    ],</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>在系统菜单中添加权限标识</p><p>我们在接口依赖中可以看到 <code>sys:api:add</code> 之类的值，这些值正是对应着菜单中的权限标识字段，只有它们完全一致，并且用户拥有对应的菜单时，才可以获得相应的操作权限</p></li></ol></div><h2 id="casbin" tabindex="-1"><a class="header-anchor" href="#casbin"><span>Casbin</span></a></h2><p>此方案是 Go 语言中比较流行的解决方案，它非常灵活，可以通过模型定义多种控制规则</p>`,7)),l("p",null,[i[1]||(i[1]=s("要想实现此 RBAC 鉴权，请先 ",-1)),p(a,{href:"../../marketplace.md"},{default:d(()=>[...i[0]||(i[0]=[s("获取插件",-1)])]),_:1}),i[2]||(i[2]=s("，然后执行以下操作",-1))]),i[4]||(i[4]=e('<div class="vp-steps"><ol><li><p>安装插件</p></li><li><p>启用鉴权</p><p>修改 <code>backend/core/conf.py</code> 文件中的 <code>RBAC_ROLE_MENU_MODE</code> 为 <code>False</code></p></li></ol></div><h2 id="解耦" tabindex="-1"><a class="header-anchor" href="#解耦"><span>解耦</span></a></h2><p>在实际项目开发中，不可能同时存在多种 RBAC 解决方案，您可以通过以下方式删除【角色菜单】集成</p><ul><li>删除 <code>backend/common/security/permission.py</code> 文件中的 <code>RequestPermission</code> 类及所有类调用</li><li>删除 <code>backend/core/conf.py</code> 文件中的 <code>RBAC_ROLE_MENU_MODE</code> 和 <code>RBAC_ROLE_MENU_EXCLUDE</code></li><li>删除 <code>backend/common/security/rbac.py</code> 文件中 <code>rbac_verify</code> 方法里面的 <code>if settings.RBAC_ROLE_MENU_MODE:</code> 条件及相关代码</li><li>删除菜单 <code>perms</code> 列及其相关的 schema 字段和 SQL 脚本</li><li>删除菜单 <code>type</code> 列中的按钮类型及其按钮类型相关的代码逻辑和 SQL 脚本</li></ul>',4))])}const B=t(c,[["render",o]]),g=JSON.parse('{"path":"/backend/reference/RBAC.html","title":"RBAC","lang":"zh-CN","frontmatter":{"title":"RBAC","description":"我们通过自定义依赖组件，实现了 RBAC 的轻松集成，它可以通过 FastAPI Depends 轻松集成 警告 自 v1.2.0 开始，默认 RBAC 已更换为【角色菜单】，【Casbin-RBAC】将作为外置插件进行分发 角色菜单 要想实现此 RBAC 鉴权，需要进行以下配置 添加接口依赖 只有在接口中添加以下依赖时，才能自动调用此鉴权方式 在系统...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"RBAC\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://fastapi-practices.github.io/fastapi_best_architecture_docs/fastapi_best_architecture_docs/backend/reference/RBAC.html"}],["meta",{"property":"og:site_name","content":"FastAPI Best Architecture"}],["meta",{"property":"og:title","content":"RBAC"}],["meta",{"property":"og:description","content":"我们通过自定义依赖组件，实现了 RBAC 的轻松集成，它可以通过 FastAPI Depends 轻松集成 警告 自 v1.2.0 开始，默认 RBAC 已更换为【角色菜单】，【Casbin-RBAC】将作为外置插件进行分发 角色菜单 要想实现此 RBAC 鉴权，需要进行以下配置 添加接口依赖 只有在接口中添加以下依赖时，才能自动调用此鉴权方式 在系统..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}]]},"readingTime":{"minutes":1.45,"words":435},"git":{"createdTime":1729925621000},"autoDesc":true,"filePathRelative":"backend/reference/RBAC.md","headers":[],"bulletin":false}');export{B as comp,g as data};
