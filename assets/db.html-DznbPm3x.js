import{_ as i,c as a,d as n,o as e}from"./app-BLJpD-6k.js";const h={};function l(t,s){return e(),a("div",null,[...s[0]||(s[0]=[n(`<div class="hint-container warning"><p class="hint-container-title">注意</p><p>fba 自 v1.10.0 开始，已将默认数据库由 MySQL 替换为 PostgreSQL</p></div><p>fba 支持 PostgreSQL、MySQL 两种数据库，默认配置使用 PostgreSQL</p><h2 id="docker-镜像" tabindex="-1"><a class="header-anchor" href="#docker-镜像"><span>Docker 镜像</span></a></h2><p>如果你未在本地安装或习惯使用 Docker 镜像，</p><h3 id="postgresql" tabindex="-1"><a class="header-anchor" href="#postgresql"><span>PostgreSQL</span></a></h3><div class="language-shell" data-highlighter="shiki" data-ext="shell" style="--shiki-dark:#abb2bf;--shiki-light:#383A42;--shiki-dark-bg:#282c34;--shiki-light-bg:#FAFAFA;"><pre class="shiki shiki-themes one-dark-pro one-light vp-code"><code class="language-shell"><span class="line"><span style="--shiki-dark:#61AFEF;--shiki-light:#4078F2;">docker</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> run</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> -d</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> \\</span></span>
<span class="line"><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">  --name</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> fba_postgres</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> \\</span></span>
<span class="line"><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">  --restart</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> always</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> \\</span></span>
<span class="line"><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">  -e</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> POSTGRES_DB=&#39;fba&#39;</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> \\</span></span>
<span class="line"><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">  -e</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> POSTGRES_PASSWORD=&#39;123456&#39;</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> \\</span></span>
<span class="line"><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">  -e</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> TZ=&#39;Asia/Shanghai&#39;</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> \\</span></span>
<span class="line"><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">  -v</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> fba_postgres:/var/lib/postgresql/data</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> \\ </span></span>
<span class="line"><span style="--shiki-dark:#61AFEF;--shiki-light:#4078F2;">  -p</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> 5432:5432</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> \\</span></span>
<span class="line"><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">  postgres:16</span></span></code></pre></div><h3 id="mysql" tabindex="-1"><a class="header-anchor" href="#mysql"><span>MySQL</span></a></h3><div class="language-shell" data-highlighter="shiki" data-ext="shell" style="--shiki-dark:#abb2bf;--shiki-light:#383A42;--shiki-dark-bg:#282c34;--shiki-light-bg:#FAFAFA;"><pre class="shiki shiki-themes one-dark-pro one-light vp-code"><code class="language-shell"><span class="line"><span style="--shiki-dark:#61AFEF;--shiki-light:#4078F2;">docker</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> run</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> -d</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> \\</span></span>
<span class="line"><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">  --name</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> fba_mysql</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> \\</span></span>
<span class="line"><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">  --restart</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> always</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> \\</span></span>
<span class="line"><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">  -e</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> MYSQL_DATABASE=fba</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> \\</span></span>
<span class="line"><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">  -e</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> MYSQL_ROOT_PASSWORD=</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">123456</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> \\</span></span>
<span class="line"><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">  -e</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> TZ=Asia/Shanghai</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> \\</span></span>
<span class="line"><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">  -v</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> fba_mysql:/var/lib/mysql</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> \\</span></span>
<span class="line"><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">  -p</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 3306</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> \\</span></span>
<span class="line"><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">  mysql:8.0.41</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> \\</span></span>
<span class="line"><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">  --default-authentication-plugin=mysql_native_password</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> \\</span></span>
<span class="line"><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">  --character-set-server=utf8mb4</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> \\</span></span>
<span class="line"><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">  --collation-server=utf8mb4_general_ci</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> \\</span></span>
<span class="line"><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">  --lower_case_table_names=1</span></span></code></pre></div><h2 id="环境配置" tabindex="-1"><a class="header-anchor" href="#环境配置"><span>环境配置</span></a></h2><p>PostgreSQL 与 MySQL 在用户名、端口号等方面有所不同，如果你使用上面的命令创建了 Docker 镜像，需修改 <code>.env</code> 部分配置如下，否则，请根据实际配置进行修改</p><h3 id="postgresql-1" tabindex="-1"><a class="header-anchor" href="#postgresql-1"><span>PostgreSQL</span></a></h3><div class="language-dotenv" data-highlighter="shiki" data-ext="dotenv" style="--shiki-dark:#abb2bf;--shiki-light:#383A42;--shiki-dark-bg:#282c34;--shiki-light-bg:#FAFAFA;"><pre class="shiki shiki-themes one-dark-pro one-light vp-code"><code class="language-dotenv"><span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;"># Database</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">DATABASE_TYPE</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;postgresql&#39;</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">DATABASE_HOST</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;127.0.0.1&#39;</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">DATABASE_PORT</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">5432</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">DATABASE_USER</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;postgres&#39;</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">DATABASE_PASSWORD</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;123456&#39;</span></span></code></pre></div><h3 id="mysql-1" tabindex="-1"><a class="header-anchor" href="#mysql-1"><span>MySQL</span></a></h3><div class="language-dotenv" data-highlighter="shiki" data-ext="dotenv" style="--shiki-dark:#abb2bf;--shiki-light:#383A42;--shiki-dark-bg:#282c34;--shiki-light-bg:#FAFAFA;"><pre class="shiki shiki-themes one-dark-pro one-light vp-code"><code class="language-dotenv"><span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;"># Database</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">DATABASE_TYPE</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;mysql&#39;</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">DATABASE_HOST</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;127.0.0.1&#39;</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">DATABASE_PORT</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">3306</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">DATABASE_USER</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;root&#39;</span></span>
<span class="line"><span style="--shiki-dark:#E06C75;--shiki-light:#E45649;">DATABASE_PASSWORD</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;123456&#39;</span></span></code></pre></div><h2 id="解耦" tabindex="-1"><a class="header-anchor" href="#解耦"><span>解耦</span></a></h2><p>如果你只想保留一种数据库，参考如下：</p><ul><li>删除 <code>with_variant</code> 相关代码（如果存在），仅保留数据库对应的类型</li><li>删除 <code>backend/core/conf.py</code> 文件中的 <code>DATABASE_TYPE</code> 及其相关的调用代码</li><li>删除 <code>.env_example</code> 和 <code>.env</code> 文件中的 <code>DATABASE_TYPE</code></li><li>更新 <code>backend/templates/py/model.jinja</code> 文件中的 <code>database_type</code> 相关代码</li><li>删除 <code>backend/sql</code> 目录中不需要的文件夹</li><li>删除 <code>docker-compose.yml</code> 文件中不需要的容器脚本</li></ul>`,17)])])}const k=i(h,[["render",l]]),r=JSON.parse('{"path":"/backend/reference/db.html","title":"切换数据库","lang":"zh-CN","frontmatter":{"title":"切换数据库","description":"注意 fba 自 v1.10.0 开始，已将默认数据库由 MySQL 替换为 PostgreSQL fba 支持 PostgreSQL、MySQL 两种数据库，默认配置使用 PostgreSQL Docker 镜像 如果你未在本地安装或习惯使用 Docker 镜像， PostgreSQL MySQL 环境配置 PostgreSQL 与 MySQL 在用...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"切换数据库\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://fastapi-practices.github.io/fastapi_best_architecture_docs/fastapi_best_architecture_docs/backend/reference/db.html"}],["meta",{"property":"og:site_name","content":"FastAPI Best Architecture"}],["meta",{"property":"og:title","content":"切换数据库"}],["meta",{"property":"og:description","content":"注意 fba 自 v1.10.0 开始，已将默认数据库由 MySQL 替换为 PostgreSQL fba 支持 PostgreSQL、MySQL 两种数据库，默认配置使用 PostgreSQL Docker 镜像 如果你未在本地安装或习惯使用 Docker 镜像， PostgreSQL MySQL 环境配置 PostgreSQL 与 MySQL 在用..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}]]},"readingTime":{"minutes":1.1,"words":331},"git":{"createdTime":1734535676000},"autoDesc":true,"filePathRelative":"backend/reference/db.md","headers":[],"bulletin":false}');export{k as comp,r as data};
