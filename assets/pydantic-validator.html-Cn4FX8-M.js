import{_ as t,c as s,d as a,o as e}from"./app-BLJpD-6k.js";const d={};function n(l,i){return e(),s("div",null,[...i[0]||(i[0]=[a(`<h2 id="内置约束参数" tabindex="-1"><a class="header-anchor" href="#内置约束参数"><span>内置约束参数</span></a></h2><p>这些是最常用的简单约束，直接在 <code>Field</code> 中传递</p><table><thead><tr><th>参数名</th><th>描述</th><th>适用类型</th><th>示例用法</th></tr></thead><tbody><tr><td><code>min_length</code></td><td>最小长度</td><td>str, bytes, list, tuple, set 等</td><td><code>Field(min_length=3)</code></td></tr><tr><td><code>max_length</code></td><td>最大长度</td><td>str, bytes, list, tuple, set 等</td><td><code>Field(max_length=50)</code></td></tr><tr><td><code>pattern</code></td><td>正则表达式匹配（等同 regex）</td><td>str</td><td><code>Field(pattern=r&#39;^[a-z]+$&#39;)</code></td></tr><tr><td><code>gt</code></td><td>大于（greater than）</td><td>int, float, Decimal</td><td><code>Field(gt=0)</code></td></tr><tr><td><code>ge</code></td><td>大于等于</td><td>int, float, Decimal</td><td><code>Field(ge=18)</code></td></tr><tr><td><code>lt</code></td><td>小于</td><td>int, float, Decimal</td><td><code>Field(lt=100)</code></td></tr><tr><td><code>le</code></td><td>小于等于</td><td>int, float, Decimal</td><td><code>Field(le=120)</code></td></tr><tr><td><code>multiple_of</code></td><td>必须是指定值的倍数</td><td>int, float, Decimal</td><td><code>Field(multiple_of=5)</code></td></tr><tr><td><code>min_items</code></td><td>序列最小元素数</td><td>list, tuple, set 等</td><td><code>Field(min_items=1)</code></td></tr><tr><td><code>max_items</code></td><td>序列最大元素数</td><td>list, tuple, set 等</td><td><code>Field(max_items=10)</code></td></tr><tr><td><code>strict</code></td><td>严格模式（禁止类型自动转换）</td><td>所有类型</td><td><code>Field(strict=True)</code></td></tr><tr><td><code>max_digits</code></td><td>Decimal 最大位数</td><td>Decimal</td><td><code>Field(max_digits=10)</code></td></tr><tr><td><code>decimal_places</code></td><td>Decimal 小数位数</td><td>Decimal</td><td><code>Field(decimal_places=2)</code></td></tr></tbody></table><h2 id="约束类型" tabindex="-1"><a class="header-anchor" href="#约束类型"><span>约束类型</span></a></h2><p>更声明式的写法，等价于上面的 <code>Field</code> 参数</p><table><thead><tr><th>约束标记</th><th>描述</th><th>适用类型</th><th>示例用法</th></tr></thead><tbody><tr><td><code>Gt(value)</code></td><td>大于 value</td><td>int, float, Decimal</td><td><code>Annotated[int, Gt(0)]</code></td></tr><tr><td><code>Ge(value)</code></td><td>大于等于 value</td><td>int, float, Decimal</td><td><code>Annotated[int, Ge(18)]</code></td></tr><tr><td><code>Lt(value)</code></td><td>小于 value</td><td>int, float, Decimal</td><td><code>Annotated[int, Lt(100)]</code></td></tr><tr><td><code>Le(value)</code></td><td>小于等于 value</td><td>int, float, Decimal</td><td><code>Annotated[int, Le(120)]</code></td></tr><tr><td><code>Len(min, max)</code></td><td>长度范围</td><td>str, bytes, list 等序列</td><td><code>Annotated[str, Len(3, 50)]</code></td></tr><tr><td><code>Pattern(regex)</code></td><td>正则匹配</td><td>str</td><td><code>Annotated[str, Pattern(r&#39;^[a-z]+$&#39;)]</code></td></tr></tbody></table><p>其他常用 Annotated 工具：</p><ul><li><code>InstanceOf[T]</code>：检查是否为指定类的实例</li><li><code>SkipValidation</code>：跳过验证（用于已信任数据）</li></ul><h2 id="自定义字段验证器" tabindex="-1"><a class="header-anchor" href="#自定义字段验证器"><span>自定义字段验证器</span></a></h2><table><thead><tr><th>类型/方式</th><th>模式（mode）选项</th><th>描述</th><th>示例场景</th></tr></thead><tbody><tr><td><code>@field_validator</code></td><td><code>after</code>（默认）、<code>before</code>、<code>plain</code>、<code>wrap</code></td><td>装饰器式，针对单个或多个字段</td><td>密码哈希、复杂格式检查</td></tr><tr><td><code>BeforeValidator(func)</code></td><td>before</td><td>函数式：在解析前运行</td><td>输入预处理、None 处理</td></tr><tr><td><code>AfterValidator(func)</code></td><td>after</td><td>函数式：在类型验证后运行</td><td>业务规则检查</td></tr><tr><td><code>PlainValidator(func)</code></td><td>plain</td><td>函数式：完全自定义，跳过内置验证</td><td>自定义类型解析</td></tr><tr><td><code>WrapValidator(func)</code></td><td>wrap</td><td>函数式：最灵活，可手动调用内置验证</td><td>复杂逻辑、自定义错误</td></tr></tbody></table><h2 id="模型级验证器" tabindex="-1"><a class="header-anchor" href="#模型级验证器"><span>模型级验证器</span></a></h2><table><thead><tr><th>类型</th><th>模式（mode）选项</th><th>描述</th><th>示例场景</th></tr></thead><tbody><tr><td><code>@model_validator</code></td><td><code>after</code>、<code>before</code>、<code>wrap</code></td><td>针对整个模型的跨字段验证</td><td>密码确认、字段依赖检查</td></tr></tbody></table><h2 id="可选字段-非必填-的验证注意事项" tabindex="-1"><a class="header-anchor" href="#可选字段-非必填-的验证注意事项"><span>可选字段（非必填）的验证注意事项</span></a></h2><p>可选字段通常这样定义：</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-dark:#abb2bf;--shiki-light:#383A42;--shiki-dark-bg:#282c34;--shiki-light-bg:#FAFAFA;"><pre class="shiki shiki-themes one-dark-pro one-light vp-code"><code class="language-python"><span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">username: </span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;">str</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> |</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> None</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> =</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> None</span></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;"># 或</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">username: </span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;">str</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> |</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> None</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> =</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> Field</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#E06C75;--shiki-dark-font-style:italic;--shiki-light:#986801;--shiki-light-font-style:inherit;">default</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">None</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">, </span><span style="--shiki-dark:#D19A66;--shiki-light:#383A42;">...</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="默认行为" tabindex="-1"><a class="header-anchor" href="#默认行为"><span>默认行为</span></a></h3><ul><li><strong>内置约束</strong>：当值为 <code>None</code> 时，完全跳过约束检查；只有提供非 <code>None</code> 值时才验证</li><li><strong>自定义验证器</strong>（<code>@field_validator</code> 或函数式）：默认在值为 <code>None</code> 或使用默认值时<strong>不运行</strong></li></ul><h3 id="常见坑点" tabindex="-1"><a class="header-anchor" href="#常见坑点"><span>常见坑点</span></a></h3><ol><li>以为 <code>min_length=3</code> 会对 <code>None</code> 报错 → 其实不会</li><li>自定义验证器不触发，导致逻辑遗漏（尤其是想对 <code>None</code> 做特殊处理时）</li><li>从 V1 迁移：V1 有 <code>always=True</code>，V2 已移除</li></ol><h3 id="推荐解决方案" tabindex="-1"><a class="header-anchor" href="#推荐解决方案"><span>推荐解决方案</span></a></h3><ol><li><p>大多数情况直接用默认行为（推荐）：</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-dark:#abb2bf;--shiki-light:#383A42;--shiki-dark-bg:#282c34;--shiki-light-bg:#FAFAFA;"><pre class="shiki shiki-themes one-dark-pro one-light vp-code"><code class="language-python"><span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">username: </span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;">str</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> |</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> None</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> =</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> Field</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">None</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">, </span><span style="--shiki-dark:#E06C75;--shiki-dark-font-style:italic;--shiki-light:#986801;--shiki-light-font-style:inherit;">min_length</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">3</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>想对 <code>None</code> 做自定义处理 → 用 <code>WrapValidator</code>（最灵活）：</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-dark:#abb2bf;--shiki-light:#383A42;--shiki-dark-bg:#282c34;--shiki-light-bg:#FAFAFA;"><pre class="shiki shiki-themes one-dark-pro one-light vp-code"><code class="language-python"><span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">from</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> pydantic </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">import</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> WrapValidator</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">def</span><span style="--shiki-dark:#61AFEF;--shiki-light:#4078F2;"> optional_validator</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#D19A66;--shiki-dark-font-style:italic;--shiki-light:#986801;--shiki-light-font-style:inherit;">v</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> str</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> |</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> None</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">,</span><span style="--shiki-dark:#D19A66;--shiki-dark-font-style:italic;--shiki-light:#986801;--shiki-light-font-style:inherit;"> handler</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">):</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    if</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> v </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">is</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> None</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        return</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> None</span><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">  # 或 raise ValueError(&quot;不能为空&quot;) / return &quot;default&quot;</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    return</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> handler</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(v)  </span><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;"># 调用内置验证</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">username: Annotated[</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;">str</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> |</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> None</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">, </span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;">WrapValidator</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(optional_validator)] </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> None</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>强制验证默认值（少用）：</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-dark:#abb2bf;--shiki-light:#383A42;--shiki-dark-bg:#282c34;--shiki-light-bg:#FAFAFA;"><pre class="shiki shiki-themes one-dark-pro one-light vp-code"><code class="language-python"><span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">model_config </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> {</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&quot;validate_default&quot;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">: </span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">True</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>预处理 None</strong> → 用 <code>BeforeValidator</code>：</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-dark:#abb2bf;--shiki-light:#383A42;--shiki-dark-bg:#282c34;--shiki-light-bg:#FAFAFA;"><pre class="shiki shiki-themes one-dark-pro one-light vp-code"><code class="language-python"><span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">def</span><span style="--shiki-dark:#61AFEF;--shiki-light:#4078F2;"> none_to_empty</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#D19A66;--shiki-dark-font-style:italic;--shiki-light:#986801;--shiki-light-font-style:inherit;">v</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> str</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> |</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> None</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">) -&gt; </span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;">str</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    return</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> v </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">or</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">username: Annotated[</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;">str</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">, </span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;">BeforeValidator</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(none_to_empty), </span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;">Field</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#E06C75;--shiki-dark-font-style:italic;--shiki-light:#986801;--shiki-light-font-style:inherit;">min_length</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">1</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)] </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;"> &#39;&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h2><p>Pydantic V2 的验证系统强大而灵活：</p><ul><li>简单场景 → 内置约束 + Annotated</li><li>复杂逻辑 → 函数式/装饰器验证器 + Wrap 模式</li><li>可选字段 → 默认行为已很智能，需要特殊处理时用 WrapValidator</li></ul>`,24)])])}const r=t(d,[["render",n]]),k=JSON.parse('{"path":"/blog/pydantic-validator.html","title":"Pydantic 字段验证方法全解析","lang":"zh-CN","frontmatter":{"title":"Pydantic 字段验证方法全解析","createTime":"2026-1-18 22:30","tags":["Pydantic"],"description":"内置约束参数 这些是最常用的简单约束，直接在 Field 中传递 约束类型 更声明式的写法，等价于上面的 Field 参数 其他常用 Annotated 工具： InstanceOf[T]：检查是否为指定类的实例 SkipValidation：跳过验证（用于已信任数据） 自定义字段验证器 模型级验证器 可选字段（非必填）的验证注意事项 可选字段通常这样...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Pydantic 字段验证方法全解析\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://fastapi-practices.github.io/fastapi_best_architecture_docs/fastapi_best_architecture_docs/blog/pydantic-validator.html"}],["meta",{"property":"og:site_name","content":"FastAPI Best Architecture"}],["meta",{"property":"og:title","content":"Pydantic 字段验证方法全解析"}],["meta",{"property":"og:description","content":"内置约束参数 这些是最常用的简单约束，直接在 Field 中传递 约束类型 更声明式的写法，等价于上面的 Field 参数 其他常用 Annotated 工具： InstanceOf[T]：检查是否为指定类的实例 SkipValidation：跳过验证（用于已信任数据） 自定义字段验证器 模型级验证器 可选字段（非必填）的验证注意事项 可选字段通常这样..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:tag","content":"Pydantic"}]]},"readingTime":{"minutes":3.03,"words":910},"git":{"createdTime":1768748388000},"autoDesc":true,"filePathRelative":"blog/pydantic-validator.md","headers":[],"categoryList":[],"bulletin":false}');export{r as comp,k as data};
