import{_ as a,c as n,d as l,b as h,r as t,o as k}from"./app-BLJpD-6k.js";const e={};function p(d,s){const i=t("VPVideoEmbed");return k(),n("div",null,[s[0]||(s[0]=l(`<p>数据权限是为了给数据添加权限而建立的，我们最常见的实现方案是仅本人数据，本部门数据... 这些就是所谓的数据权限，你可以控制不同的角色拥有不同的数据权限，从而实现用户和数据的隔离</p><h2 id="常见方案" tabindex="-1"><a class="header-anchor" href="#常见方案"><span>常见方案</span></a></h2><div class="hint-container caution"><p class="hint-container-title">警告</p><p>fba 已删除此集成方式，此代码仅作为示例保留</p></div><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-dark:#abb2bf;--shiki-light:#383A42;--shiki-dark-bg:#282c34;--shiki-light-bg:#FAFAFA;"><pre class="shiki shiki-themes one-dark-pro one-light vp-code"><code class="language-python"><span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">def</span><span style="--shiki-dark:#61AFEF;--shiki-light:#4078F2;"> filter_data_permission</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#D19A66;--shiki-dark-font-style:italic;--shiki-light:#986801;--shiki-light-font-style:inherit;">request_user</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#986801;"> GetUserInfoWithRelationDetail</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">,</span><span style="--shiki-dark:#D19A66;--shiki-dark-font-style:italic;--shiki-light:#986801;--shiki-light-font-style:inherit;"> model</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#986801;"> Any</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">) -&gt; ColumnElement[</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;">bool</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">]:</span></span>
<span class="line"><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">    过滤数据权限，控制用户可见数据范围</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">    :param request_user: 请求用户</span></span>
<span class="line"><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">    :param model: 需要进行数据过滤的 sqlalchemy 模型</span></span>
<span class="line"><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">    :return:</span></span>
<span class="line"><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">    # 超级管理员可查看所有数据</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    if</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> request_user.is_superuser:</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        return</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> or_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">1</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> ==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 1</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">    # 无角色只能查看自己数据</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    if</span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;"> not</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> request_user.roles:</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        return</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> or_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;">getattr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(model, </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;created_by&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">) </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> request_user.id </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">if</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> hasattr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(model, </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;created_by&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">) </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">else</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 1</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> ==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 0</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">    data_scope </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> min</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(role.data_scope </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">for</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> role </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">in</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> request_user.roles </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">if</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> role.status </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 1</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">    user_dept_id </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> user.dept_id</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">    # 全部数据权限</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    if</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> data_scope </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 0</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        return</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> or_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">1</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> ==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 1</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">    # 自定义数据权限</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    elif</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> data_scope </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 1</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">        dept_ids </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> select</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(role_dept.c.dept_id).</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;">where</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">            role_dept.c.role_id.</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;">in_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(role.id </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">for</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> role </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">in</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> request_user.roles </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">if</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> role.status </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 1</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">        )</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        return</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> or_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;">getattr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(model, </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;dept_id&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">).</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;">in_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(dept_ids) </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">if</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> hasattr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(model, </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;dept_id&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">) </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">else</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 1</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> ==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 0</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">    # 部门及以下数据权限</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    elif</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> data_scope </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 2</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">        child_dept_ids </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> select</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(Dept.id).</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;">where</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;">or_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(Dept.id </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> user_dept_id, Dept.parent_id </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> user_dept_id))</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        return</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> or_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;">getattr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(model, </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;dept_id&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">).</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;">in_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(child_dept_ids) </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">if</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> hasattr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(model, </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;dept_id&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">) </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">else</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 1</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> ==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 0</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">    # 本部门数据权限</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    elif</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> data_scope </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 3</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        return</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> or_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;">getattr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(model, </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;dept_id&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">) </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> user_dept_id </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">if</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> hasattr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(model, </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;dept_id&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">) </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">else</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 1</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> ==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 0</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">    # 仅本人数据权限</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    elif</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> data_scope </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 4</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        return</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> or_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;">getattr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(model, </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;created_by&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">) </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> request_user.id </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">if</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> hasattr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(model, </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;created_by&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">) </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">else</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 1</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> ==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 0</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">    # 默认</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    else</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        return</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> or_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">1</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> ==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 0</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="弊端" tabindex="-1"><a class="header-anchor" href="#弊端"><span>弊端</span></a></h3><p>我们常见的这种数据权限，在大多数情况下，也能够满足日常场景所需，但是，这种方式存在严重的弊端。由于数据权限的数据过滤是通过 SQL 语句拼接进行实现的，而这些固定权限，直接写死了数据权限的要求</p><p>例如：业务表必须包含 dept_id 和 created_by 字段，如果业务表没有这些字段，你就无法通过 SQL 来控制数据权限</p><h2 id="内置方案" tabindex="-1"><a class="header-anchor" href="#内置方案"><span>内置方案</span></a></h2><p>有没有一种更加灵活的方案呢，答案是，当然有，目前，我们在 fba 中实现的正是超灵活方案，但相比于常见方案来讲，配置会更加复杂</p><p>你可以直接查看代码源文件 <code>backend/common/security/permission.py</code> ，它与常规方案使用近乎相同的方式实现数据过滤，但由于其复杂性，下面，我们将通过视频进行讲解：</p>`,10)),h(i,{src:"https://player.bilibili.com/player.html?bvid=BV13hioY1EQU&autoplay=0&high_quality=1",width:"100%",title:"Bilibili",type:"bilibili"})])}const A=a(e,[["render",p]]),B=JSON.parse('{"path":"/backend/reference/data-permission.html","title":"数据权限","lang":"zh-CN","frontmatter":{"title":"数据权限","description":"数据权限是为了给数据添加权限而建立的，我们最常见的实现方案是仅本人数据，本部门数据... 这些就是所谓的数据权限，你可以控制不同的角色拥有不同的数据权限，从而实现用户和数据的隔离 常见方案 警告 fba 已删除此集成方式，此代码仅作为示例保留 弊端 我们常见的这种数据权限，在大多数情况下，也能够满足日常场景所需，但是，这种方式存在严重的弊端。由于数据权...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"数据权限\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://fastapi-practices.github.io/fastapi_best_architecture_docs/fastapi_best_architecture_docs/backend/reference/data-permission.html"}],["meta",{"property":"og:site_name","content":"FastAPI Best Architecture"}],["meta",{"property":"og:title","content":"数据权限"}],["meta",{"property":"og:description","content":"数据权限是为了给数据添加权限而建立的，我们最常见的实现方案是仅本人数据，本部门数据... 这些就是所谓的数据权限，你可以控制不同的角色拥有不同的数据权限，从而实现用户和数据的隔离 常见方案 警告 fba 已删除此集成方式，此代码仅作为示例保留 弊端 我们常见的这种数据权限，在大多数情况下，也能够满足日常场景所需，但是，这种方式存在严重的弊端。由于数据权..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}]]},"readingTime":{"minutes":1.18,"words":355},"git":{"createdTime":1758470082000},"autoDesc":true,"filePathRelative":"backend/reference/data-permission.md","headers":[],"bulletin":false}');export{A as comp,B as data};
