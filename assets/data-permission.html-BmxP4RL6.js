import{_ as i,c as a,f as n,o as l}from"./app-DqtJ7nxx.js";const h={};function t(k,s){return l(),a("div",null,[...s[0]||(s[0]=[n(`<p>数据权限是为了给数据添加权限而建立的，我们最常见的实现方式是仅本人数据，本部门数据... 这些就是所谓的数据权限，你可以控制不同的角色拥有不同的数据权限，从而实现用户和数据的隔离</p><h2 id="弊端" tabindex="-1"><a class="header-anchor" href="#弊端"><span>弊端</span></a></h2><p>如上所述，我们常见的这种数据权限，在大多数情况下，也能够满足日常场景所需，但是，这种常见的方式存在严重的弊端。由于数据权限的数据过滤是通过 SQL 语句拼接进行实现的，而这些固定权限，直接写死了数据权限的要求，例如：业务表必须包含 dept_id 和 created_by 字段， 如果没有这些业务字段，你就无法通过 SQL 来控制数据权限，下面是我对这种常规数据权限的实现，仅供参考：</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-dark:#abb2bf;--shiki-light:#383A42;--shiki-dark-bg:#282c34;--shiki-light-bg:#FAFAFA;"><pre class="shiki shiki-themes one-dark-pro one-light vp-code"><code class="language-python"><span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">def</span><span style="--shiki-dark:#61AFEF;--shiki-light:#4078F2;"> filter_data_permission</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#D19A66;--shiki-dark-font-style:italic;--shiki-light:#986801;--shiki-light-font-style:inherit;">request</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#986801;"> Request</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">,</span><span style="--shiki-dark:#D19A66;--shiki-dark-font-style:italic;--shiki-light:#986801;--shiki-light-font-style:inherit;"> model</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#986801;"> Any</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">) -&gt; ColumnElement[</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;">bool</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">]:</span></span>
<span class="line"><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">    过滤用户数据权限</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">    :param request: 接口请求对象</span></span>
<span class="line"><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">    :param model: 需要进行数据过滤的 sqlalchemy 模型</span></span>
<span class="line"><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">    :return:</span></span>
<span class="line"><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">    user </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> request.user</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">    # 超级管理员可查看所有数据</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    if</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> user.is_superuser:</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        return</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> or_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">1</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> ==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 1</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">    user_id </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> user.id</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">    user_roles </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> user.roles</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">    # 无角色只能查看自己数据</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    if</span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;"> not</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> user_roles:</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        return</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> or_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;">getattr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(model, </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;created_by&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">) </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> user_id </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">if</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> hasattr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(model, </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;created_by&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">) </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">else</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 1</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> ==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 0</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">    data_scope </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> min</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(role.data_scope </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">for</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> role </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">in</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> user_roles </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">if</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> role.status </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 1</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">    user_dept_id </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> user.dept_id</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">    # 全部数据权限</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    if</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> data_scope </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 0</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        return</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> or_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">1</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> ==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 1</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">    # 自定义数据权限</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    elif</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> data_scope </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 1</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">        dept_ids </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> select</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(sys_role_dept.c.dept_id).</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;">where</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">            sys_role_dept.c.role_id.</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;">in_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(role.id </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">for</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> role </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">in</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> user_roles </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">if</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> role.status </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 1</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">        )</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        return</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> or_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;">getattr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(model, </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;dept_id&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">).</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;">in_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(dept_ids) </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">if</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> hasattr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(model, </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;dept_id&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">) </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">else</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 1</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> ==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 0</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">    # 部门及以下数据权限</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    elif</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> data_scope </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 2</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">        child_dept_ids </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> select</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(Dept.id).</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;">where</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;">or_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(Dept.id </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> user_dept_id, Dept.parent_id </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> user_dept_id))</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        return</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> or_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;">getattr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(model, </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;dept_id&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">).</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;">in_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(child_dept_ids) </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">if</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> hasattr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(model, </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;dept_id&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">) </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">else</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 1</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> ==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 0</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">    # 本部门数据权限</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    elif</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> data_scope </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 3</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        return</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> or_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;">getattr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(model, </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;dept_id&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">) </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> user_dept_id </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">if</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> hasattr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(model, </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;dept_id&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">) </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">else</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 1</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> ==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 0</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">    # 仅本人数据权限</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    elif</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> data_scope </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 4</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        return</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> or_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;">getattr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(model, </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;created_by&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">) </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">==</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;"> user_id </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">if</span><span style="--shiki-dark:#56B6C2;--shiki-light:#0184BC;"> hasattr</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(model, </span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;created_by&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">) </span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">else</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 1</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> ==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 0</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;">    # 默认</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">    else</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">:</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">        return</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> or_</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;">1</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;"> ==</span><span style="--shiki-dark:#D19A66;--shiki-light:#986801;"> 0</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>请注意，当前 fba 中已删除此集成方式，你需要自行更新角色 model、schema，添加数据权限控制标识字段 data_scope 等相关代码</p><h2 id="想法" tabindex="-1"><a class="header-anchor" href="#想法"><span>想法</span></a></h2><p>有没有一种更加灵活的方案呢，答案是，当然有，目前，我们在 fba 中实现的正式超灵活方案，但是相对于常见方案来讲，可配更加复杂，但我们仍有很大的优化空间</p><p>你可以直接查看代码源文件 <code>backend/common/security/permission.py</code>，其中，filter_data_permission 方法正是我们使用灵活方案，它与常规数据权限使用近乎相同的方式实现数据过滤，但由于其复杂性，下面，我们将通过视频进行讲解： <a href="https://www.bilibili.com/video/BV13hioY1EQU/?share_source=copy_web&amp;vd_source=ccb2aae47e179a51460c20d165021cb7" target="_blank" rel="noopener noreferrer">数据权限管理</a></p>`,8)])])}const p=i(h,[["render",t]]),d=JSON.parse('{"path":"/backend/reference/data-permission.html","title":"数据权限","lang":"zh-CN","frontmatter":{"title":"数据权限","description":"数据权限是为了给数据添加权限而建立的，我们最常见的实现方式是仅本人数据，本部门数据... 这些就是所谓的数据权限，你可以控制不同的角色拥有不同的数据权限，从而实现用户和数据的隔离 弊端 如上所述，我们常见的这种数据权限，在大多数情况下，也能够满足日常场景所需，但是，这种常见的方式存在严重的弊端。由于数据权限的数据过滤是通过 SQL 语句拼接进行实现的，...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"数据权限\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-09-21T15:54:42.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://fastapi-practices.github.io/fastapi_best_architecture_docs/fastapi_best_architecture_docs/backend/reference/data-permission.html"}],["meta",{"property":"og:site_name","content":"FastAPI Best Architecture"}],["meta",{"property":"og:title","content":"数据权限"}],["meta",{"property":"og:description","content":"数据权限是为了给数据添加权限而建立的，我们最常见的实现方式是仅本人数据，本部门数据... 这些就是所谓的数据权限，你可以控制不同的角色拥有不同的数据权限，从而实现用户和数据的隔离 弊端 如上所述，我们常见的这种数据权限，在大多数情况下，也能够满足日常场景所需，但是，这种常见的方式存在严重的弊端。由于数据权限的数据过滤是通过 SQL 语句拼接进行实现的，..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-09-21T15:54:42.000Z"}],["meta",{"property":"article:modified_time","content":"2025-09-21T15:54:42.000Z"}]]},"readingTime":{"minutes":1.46,"words":439},"git":{"createdTime":1758470082000,"updatedTime":1758470082000},"autoDesc":true,"filePathRelative":"backend/reference/data-permission.md","headers":[],"bulletin":true}');export{p as comp,d as data};
