import{_ as e,c as a,d as t,b as n,r as h,o as r}from"./app-BLJpD-6k.js";const l={};function p(d,i){const s=h("Mermaid");return r(),a("div",null,[i[0]||(i[0]=t(`<p>我们编写了 JWT 授权中间件，使其可以在每次请求发起时，能够实现自动授权，并且还使用 Redis 和 Rust 库对用户信息进行缓存和解析，使其性能影响尽可能降到最低</p><h2 id="接口鉴权" tabindex="-1"><a class="header-anchor" href="#接口鉴权"><span>接口鉴权</span></a></h2><p>在文件 <code>backend/common/security/jwt.py</code> 中，包含以下代码</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-dark:#abb2bf;--shiki-light:#383A42;--shiki-dark-bg:#282c34;--shiki-light-bg:#FAFAFA;"><pre class="shiki shiki-themes one-dark-pro one-light vp-code"><code class="language-python"><span class="line"><span style="--shiki-dark:#7F848E;--shiki-dark-font-style:italic;--shiki-light:#A0A1A7;--shiki-light-font-style:italic;"># JWT dependency injection</span></span>
<span class="line"><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">DependsJwtAuth </span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;"> Depends</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;">HTTPBearer</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">())</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>我们通过在接口函数中添加此依赖实现 JWT 快速校验，它可以帮助我们检查请求头中是否包含 Bearer Token，使用方式参考如下：</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-dark:#abb2bf;--shiki-light:#383A42;--shiki-dark-bg:#282c34;--shiki-light-bg:#FAFAFA;"><pre class="shiki shiki-themes one-dark-pro one-light vp-code"><code class="language-python"><span class="line highlighted"><span style="--shiki-dark:#61AFEF;--shiki-light:#4078F2;">@router</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#4078F2;">.</span><span style="--shiki-dark:#61AFEF;--shiki-light:#4078F2;">get</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">(</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;/hello&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">,</span><span style="--shiki-dark:#E06C75;--shiki-dark-font-style:italic;--shiki-light:#986801;--shiki-light-font-style:inherit;"> summary</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#98C379;--shiki-light:#50A14F;">&#39;你好&#39;</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">,</span><span style="--shiki-dark:#E06C75;--shiki-dark-font-style:italic;--shiki-light:#986801;--shiki-light-font-style:inherit;"> dependencies</span><span style="--shiki-dark:#56B6C2;--shiki-light:#383A42;">=</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">[</span><span style="--shiki-dark:#61AFEF;--shiki-light:#383A42;">DependsJwtAuth</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">])</span></span>
<span class="line"><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;">async</span><span style="--shiki-dark:#C678DD;--shiki-light:#A626A4;"> def</span><span style="--shiki-dark:#61AFEF;--shiki-light:#4078F2;"> hello</span><span style="--shiki-dark:#ABB2BF;--shiki-light:#383A42;">():</span></span>
<span class="line"><span style="--shiki-dark:#D19A66;--shiki-light:#383A42;">    ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="token" tabindex="-1"><a class="header-anchor" href="#token"><span>Token</span></a></h2><p>内置 token 授权方式遵循 <a href="https://datatracker.ietf.org/doc/html/rfc6750" target="_blank" rel="noopener noreferrer">rfc6750</a></p><h2 id="swagger-登录" tabindex="-1"><a class="header-anchor" href="#swagger-登录"><span>Swagger 登录</span></a></h2><p>这是一种快捷的授权方式，仅用于调试目的，在服务启动后，进入 Swagger 文档，可通过此调试接口快速获取 token（无需验证码）</p><h2 id="验证码登录" tabindex="-1"><a class="header-anchor" href="#验证码登录"><span>验证码登录</span></a></h2><p>你可以通过此方式获取 token，在大多数情况下，这更适用于配合前端实现登录授权</p><p>我们在 fba 中使用 <a href="https://github.com/wu-clan/fast-captcha" target="_blank" rel="noopener noreferrer">fast_captcha</a> 生成 base64 验证码，然后通过接口进行数据返回；您可以通过在线 base64 转图片或配合前端项目将其转为图片进行预览</p><h3 id="授权流程" tabindex="-1"><a class="header-anchor" href="#授权流程"><span>授权流程</span></a></h3>`,14)),n(s,{code:"eJy9kcFOwkAQhu99in2BpvHaGE4ajxrlbtZaoREBoXgGE6QY1KKYAJKAHAzR0IaYWLQVX8bptidewW1rm2JIvHFqd/b7Z/5/lmVZRpbkjMgj97nh6BUyqJCOCZ/3btl0Zk3GA5iieFoSs4K4IeFUAZ8wCGFBzhUQaENbMciLTivRP2ITCeQYOmlNeLS1mVw/KHAJDucl7myNwyU5zQk4LwtpTEUB5ivcYZNc19yOCsobdEY8sgePviXDnpwHl1Twh0JsfBhUK442XWx7hIvy/u9AHpFW31ZUt3tj9z6ivFQQp3zZrngoFSlv3cG4HSeXx9zZ3luSM5NLSdmVpCStEXUF6lXYMCrYbR3UJ+iNyKtJzP73dEwD0SPVR8xif7fcdb48F3Hb4QbC/lFhbinBkuC2AQ8zUq/BRRW097lV94KE2P8jkrljMRu+UHCigP8NxNHmqQdFhcs+8wPBfG9C",title:"eJx7uarnxfrG5wsan8/c/XTv1JcNu1/smwgAphcPDQ=="})])}const c=e(l,[["render",p]]),o=JSON.parse('{"path":"/backend/reference/jwt.html","title":"JWT","lang":"zh-CN","frontmatter":{"title":"JWT","description":"我们编写了 JWT 授权中间件，使其可以在每次请求发起时，能够实现自动授权，并且还使用 Redis 和 Rust 库对用户信息进行缓存和解析，使其性能影响尽可能降到最低 接口鉴权 在文件 backend/common/security/jwt.py 中，包含以下代码 我们通过在接口函数中添加此依赖实现 JWT 快速校验，它可以帮助我们检查请求头中是否包...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"JWT\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://fastapi-practices.github.io/fastapi_best_architecture_docs/fastapi_best_architecture_docs/backend/reference/jwt.html"}],["meta",{"property":"og:site_name","content":"FastAPI Best Architecture"}],["meta",{"property":"og:title","content":"JWT"}],["meta",{"property":"og:description","content":"我们编写了 JWT 授权中间件，使其可以在每次请求发起时，能够实现自动授权，并且还使用 Redis 和 Rust 库对用户信息进行缓存和解析，使其性能影响尽可能降到最低 接口鉴权 在文件 backend/common/security/jwt.py 中，包含以下代码 我们通过在接口函数中添加此依赖实现 JWT 快速校验，它可以帮助我们检查请求头中是否包..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}]]},"readingTime":{"minutes":1.55,"words":464},"git":{"createdTime":1734535676000},"autoDesc":true,"filePathRelative":"backend/reference/jwt.md","headers":[],"bulletin":false}');export{c as comp,o as data};
